<script>

function markerNevigation(pos) {  
    var originPos = getUserCenterPos();

    const destinationPos = {
        lat: Number(pos.split(', ')[0].split('(')[1]),
        lng: Number(pos.split(', ')[1].split(')')[0]),
    }

    let request = {
        origin: originPos,
        destination: destinationPos,
        travelMode: 'DRIVING'
    };
    
    directionsService.route(request, function(response, status) {
        if (status == 'OK') {
            directionsRenderer.setDirections(response);
        }
        else {
            alert(status)
        }
    });
}

function newSearchCenter(composeParam) {
    // TODO : turn on the same window info

    removeMarker(MARKERS);
    clearArray(MARKERWINDOWINFOS);
    clearArray(MARKERTYPE);

    // composeParam = "(xx.xxxx, xx.xxxx)/[type]/[title]"
    pos = composeParam.split('/')[0]
    type = composeParam.split('/')[1]
    title = composeParam.split('/')[2]

    //pos = "(xx.xxxx, xx.xxxx)"
    const center = {
        lat: Number(pos.split(', ')[0].split('(')[1]),
        lng: Number(pos.split(', ')[1].split(')')[0]),
    }

    // tpye: ORIGIN or USERCLICK
    if(type == USERCLICK)
        lastCenterType = USERCLICK

    aim2Map(CLOSERZOOM, center);
    readDataFromFirestore(center);
}

function reportMarker(content) {
    var today = getTodayDate()
    if(confirm("report this marker : " + content + " ?")) 
    {
        db.collection("Report").add({
            time: today,
            location: content,
            status: false,
        }).then((docRef) => {
            window.alert("Thanks for your help!");
        }).catch((error) => {
            handleError("reportMarker", DATABASE_UPLOAD_ERROR);
        });
    } 
}

function getTodayDate() {
    var date = new Date()
    var year = date.getFullYear().toString();
    var month = date.getMonth()+1 < 10 ?
        '0' + (date.getMonth()+1).toString() : (date.getMonth()+1).toString()
    var day = date.getDate()+1 < 10 ?
        '0' + (date.getDate()+1).toString() : (date.getDate()+1).toString()    
    return year+month+day
}

</script>